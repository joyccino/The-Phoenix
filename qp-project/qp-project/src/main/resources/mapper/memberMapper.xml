<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.phoenix.qpproject.mapper.MemberMapper">
    <select id="login" resultType="com.phoenix.qpproject.dto.MembersDTO">
        SELECT
        m.id
        ,m.userId		AS memberId
        ,m.Email        AS memberEmail
        ,m.Surname		AS memberSurname
        ,m.Firstname		AS memberFirstname
        ,m.BirthDate	AS memberBDate
        ,m.RegisterDate	AS memberRegDate
        ,m.RecentVisit	AS memberVisit
        ,m.Gender	    AS memberGender
        ,m.MemberTypeId	AS memberMemberTypeId
        ,m.InstitutionId AS memberInstitutionId
        ,m.MembershipExpirationDate	AS memberMembershipDate
        ,m.Country	    AS memberCountry
        ,m.City	        AS memberCity
        ,m.MajorId	    AS memberMajorId
        ,m.Grade	    AS memberGrade
        ,m.Password	    AS memberPw
        ,m.isReported   AS memberIsReported;
        ,m.isBlocked    AS memberIsBlocked;
        ,m.isRemoved    AS memberIsRemoved;
        ,m.reportedDateTime  AS memberIsReportedDateTime;
        ,m.blockedDateTime  AS memberIsBlockedDateTime;
        ,m.removedDateTime  AS memberIsRemovedDateTime;
        ,m.reportedMemberId AS memberReportedMemberId;
        FROM
        members AS m
        WHERE
        userId = #{memberId}
        AND
        Password = #{memberPw};
    </select>
    <select id="getMemberList" resultType="com.phoenix.qpproject.dto.MembersDTO">
        SELECT
            m.id
            ,m.userId		AS memberId
            ,m.Email        AS memberEmail
            ,m.Surname		AS memberSurname
            ,m.Firstname		AS memberFirstname
            ,m.BirthDate	AS memberBDate
            ,m.RegisterDate	AS memberRegDate
            ,m.RecentVisit	AS memberVisit
            ,m.Gender	    AS memberGender
            ,m.MemberTypeId	AS memberMemberTypeId
            ,m.InstitutionId AS memberInstitutionId
            ,m.MembershipExpirationDate	AS memberMembershipDate
            ,m.Country	    AS memberCountry
            ,m.City	        AS memberCity
            ,m.MajorId	    AS memberMajorId
            ,m.Grade	    AS memberGrade
            ,m.Password	    AS memberPw
        FROM
            members AS m;
    </select>

    <select id="getUserAccount" resultType="com.phoenix.qpproject.dto.MembersDTO">
        SELECT
        m.id
        ,m.userId		AS memberId
        ,m.Email        AS memberEmail
        ,m.Surname		AS memberSurname
        ,m.Firstname		AS memberFirstname
        ,m.BirthDate	AS memberBDate
        ,m.RegisterDate	AS memberRegDate
        ,m.RecentVisit	AS memberVisit
        ,m.Gender	    AS memberGender
        ,m.MemberTypeId	AS memberMemberTypeId
        ,m.InstitutionId AS memberInstitutionId
        ,m.MembershipExpirationDate	AS memberMembershipDate
        ,m.Country	    AS memberCountry
        ,m.City	        AS memberCity
        ,m.MajorId	    AS memberMajorId
        ,m.Grade	    AS memberGrade
        ,m.Password	    AS memberPw
        FROM
        members AS m
        WHERE userId = #{memberId};
    </select>

    <select id="checkMemberById"  parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM members WHERE UserId = #{memberId};
    </select>

    <select id="checkMemberByEmail"  parameterType="java.lang.String" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM members WHERE Email = #{memberEmail};
    </select>

    <insert id="addMember" parameterType="com.phoenix.qpproject.dto.MembersDTO">
        /* 회원가입 */
        INSERT INTO members
        (	  Email
        , UserId
        , Surname
        , Firstname
        , BirthDate
        , RegisterDate
        , RecentVisit
        , Gender
        , MemberTypeId
        , Password
        , Country
        , City
        )VALUES (
        #{memberEmail}
        , #{memberId}
        , #{memberSurname}
        , #{memberFirstname}
        , #{memberBDate}
        , NOW()
        , NOW()
        , #{memberGender}
        , 2
        , #{memberPw}
        , "대한민국"
        , "서울"
        );
    </insert>

    <insert id="addVisitHistory" parameterType="java.lang.Integer">
        INSERT INTO visitHistory
        (	  memberId,
        visitDateTime
        )VALUES (
        #{memberId}
        , NOW()
        );
    </insert>

    <update id="passReset" parameterType="java.lang.String">
        UPDATE members SET Password = #{resetPass} WHERE Email = #{memberEmail};
    </update>
</mapper>